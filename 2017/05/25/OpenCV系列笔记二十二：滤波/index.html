<!doctype html>





  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Cpp,OpenCV," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="Overview滤波在信号处理领域具有广泛的应用。同样的，我们可以通过 Fourier transform 或者 Cosine transform将空域（ spatial domain）上的图像信息转化到频域（frequency domain）。这里我们暂时不做深入了解，只需要了解：图像中的一些边缘和细节（变化较大的部分）对应频域中的高频部分，图像中较为平坦，变化不大的地方对应频域的低频部分。
基">
<meta property="og:type" content="article">
<meta property="og:title" content="OpenCV系列笔记二十二：滤波">
<meta property="og:url" content="http://datahonor.com/2017/05/25/OpenCV系列笔记二十二：滤波/index.html">
<meta property="og:site_name" content="DATA HONOR">
<meta property="og:description" content="Overview滤波在信号处理领域具有广泛的应用。同样的，我们可以通过 Fourier transform 或者 Cosine transform将空域（ spatial domain）上的图像信息转化到频域（frequency domain）。这里我们暂时不做深入了解，只需要了解：图像中的一些边缘和细节（变化较大的部分）对应频域中的高频部分，图像中较为平坦，变化不大的地方对应频域的低频部分。
基">
<meta property="og:image" content="http://blog-1252464519.costj.myqcloud.com/1705/Selection_052501.png">
<meta property="og:image" content="http://blog-1252464519.costj.myqcloud.com/1705/Selection_052502.png">
<meta property="og:image" content="http://blog-1252464519.costj.myqcloud.com/1705/Selection_052503.png">
<meta property="og:image" content="http://blog-1252464519.costj.myqcloud.com/1705/Selection_052504.png">
<meta property="og:image" content="http://blog-1252464519.costj.myqcloud.com/1705/Selection_052505.png">
<meta property="og:image" content="http://blog-1252464519.costj.myqcloud.com/1705/Selection_052506.png">
<meta property="og:image" content="http://blog-1252464519.costj.myqcloud.com/1705/Selection_052508.png">
<meta property="og:updated_time" content="2017-05-25T10:04:38.167Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="OpenCV系列笔记二十二：滤波">
<meta name="twitter:description" content="Overview滤波在信号处理领域具有广泛的应用。同样的，我们可以通过 Fourier transform 或者 Cosine transform将空域（ spatial domain）上的图像信息转化到频域（frequency domain）。这里我们暂时不做深入了解，只需要了解：图像中的一些边缘和细节（变化较大的部分）对应频域中的高频部分，图像中较为平坦，变化不大的地方对应频域的低频部分。
基">
<meta name="twitter:image" content="http://blog-1252464519.costj.myqcloud.com/1705/Selection_052501.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"right","display":"always","offset":12,"offset_float":0,"b2t":false,"scrollpercent":true},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '不秩稚童'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://datahonor.com/2017/05/25/OpenCV系列笔记二十二：滤波/"/>





  <title> OpenCV系列笔记二十二：滤波 | DATA HONOR </title><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  




<!-- hexo-inject:begin --><!-- hexo-inject:end --><script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-92663335-1', 'auto');
  ga('send', 'pageview');
</script>


  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?cbfd16620150a28ce4061f717038b4de";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>










  
  
    
  

  <div class="container one-collumn sidebar-position-right page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">DATA HONOR</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Never say never.</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocapitalize="off" autocomplete="off" autocorrect="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://datahonor.com/2017/05/25/OpenCV系列笔记二十二：滤波/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="不秩稚童">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/17157965?v=3&u=1787d5d04d50967c7825062bfff705ee584ae2b2&s=400">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="DATA HONOR">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="DATA HONOR" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                OpenCV系列笔记二十二：滤波
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-25T15:33:11+08:00">
                2017-05-25
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Cpp/" itemprop="url" rel="index">
                    <span itemprop="name">Cpp</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/05/25/OpenCV系列笔记二十二：滤波/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/05/25/OpenCV系列笔记二十二：滤波/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i>本文总阅读量
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>次
            </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h4 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h4><p>滤波在信号处理领域具有广泛的应用。同样的，我们可以通过 Fourier transform 或者 Cosine transform将空域（ spatial domain）上的图像信息转化到频域（frequency domain）。这里我们暂时不做深入了解，只需要了解：图像中的一些边缘和细节（变化较大的部分）对应频域中的高频部分，图像中较为平坦，变化不大的地方对应频域的低频部分。</p>
<p>基于上面的结论，我们称进行滤波的工具为滤波器(filter)，根据不同的过滤方式分为低通滤波器（ low-pass filter ）和高通滤波器( high-pass filter ).</p>
<p>我们将展示mean filter, gaussian filter, median filter 等多种滤波器的使用。</p>
<h4 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h4><h5 id="Downsampling-images-with-filters"><a href="#Downsampling-images-with-filters" class="headerlink" title="Downsampling images with filters"></a>Downsampling images with filters</h5><p>我们在进行downsampling的时候，如果不进行低通滤波器的处理，直接去除行列的话，结果会比较糟糕：</p>
<p><img src="http://blog-1252464519.costj.myqcloud.com/1705/Selection_052501.png" alt=""></p>
<p>可以看到，在直接downsampling的时候，原图像的细节，也就是高频部分无法在如此小的空间（如此少的像素数）上表现出来，还会出现spatial aliasing的现象。所以，我们一般进经过low-pass filter处理后在进行downsampling，这种做法即是遵从 Nyquist-Shannon theorem.而效果也是有较高的提升的：</p>
<p><img src="http://blog-1252464519.costj.myqcloud.com/1705/Selection_052502.png" alt=""></p>
<p>下面是一些低通滤波器具体的应用：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cv.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/imgcodecs.hpp&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv/cv.hpp&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">    cv::Mat image = cv::imread(<span class="string">"/home/shensir/Documents/MyPrograming/Cpp/Clions/data/lake.png"</span>,<span class="number">0</span>);</div><div class="line">    <span class="keyword">if</span> (!image.data)</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line"></div><div class="line">    cv::imshow(<span class="string">"Original Image"</span>, image);</div><div class="line"></div><div class="line">    cv::Mat result;</div><div class="line"></div><div class="line">    <span class="comment">// Mean filtered</span></div><div class="line">    cv::blur(image, result, cv::Size(<span class="number">5</span>,<span class="number">5</span>)); <span class="comment">// size of the filter</span></div><div class="line">    cv::imshow(<span class="string">"Mean filtered Image"</span>, result);</div><div class="line"></div><div class="line">    <span class="comment">// Gaussian filtered Image</span></div><div class="line">    cv::GaussianBlur(image, result, cv::Size(<span class="number">5</span>,<span class="number">5</span>), <span class="number">1.5</span>);</div><div class="line">    cv::namedWindow(<span class="string">"Gaussian filtered Image"</span>);</div><div class="line">    cv::imshow(<span class="string">"Gaussian filtered Image"</span>, result);</div><div class="line"></div><div class="line">    <span class="comment">// 应用高斯滤波后进行downsampling</span></div><div class="line">    cv::<span class="function">Mat <span class="title">reduced</span><span class="params">(image.rows/<span class="number">4</span>, image.cols/<span class="number">4</span>, CV_8U)</span></span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;reduced.rows; i++)&#123;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;reduced.cols; j++)&#123;</div><div class="line">            reduced.at&lt;uchar&gt;(i, j) = result.at&lt;uchar&gt;(i*<span class="number">4</span>, j*<span class="number">4</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    cv::imshow(<span class="string">"downsampling gaussian"</span>, reduced);</div><div class="line">    cv::imwrite(<span class="string">"gaussian-redeced.jpg"</span>, reduced);</div><div class="line"></div><div class="line">    <span class="comment">// 图像金字塔</span></div><div class="line">    cv::Mat reducedImage;</div><div class="line">    cv::pyrDown(result, reducedImage);  <span class="comment">// reduce by half</span></div><div class="line">    cv::imshow(<span class="string">"pyDownImage"</span>, reducedImage);</div><div class="line"></div><div class="line">    <span class="comment">// resizing</span></div><div class="line">    cv::Mat resized;</div><div class="line">    cv::resize(image, resized, cv::Size(), <span class="number">2</span>, <span class="number">2</span>, cv::INTER_LINEAR);</div><div class="line">    cv::imshow(<span class="string">"resized"</span>, resized);</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">// Median filtered</span></div><div class="line">    cv::medianBlur(image, result, <span class="number">5</span>); <span class="comment">// size of the filter</span></div><div class="line">    cv::imshow(<span class="string">"Mean filtered Image"</span>, result);</div><div class="line"></div><div class="line">    cv::waitKey();</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"></div></pre></td></tr></table></figure>
<p>输出：<br><img src="http://blog-1252464519.costj.myqcloud.com/1705/Selection_052503.png" alt=""></p>
<p>median filter（注意其为no-linear）输出：</p>
<p><img src="http://blog-1252464519.costj.myqcloud.com/1705/Selection_052504.png" alt=""></p>
<p>注意，基于图像金字塔的操作pyDown和pyUp是不可逆的。而pyDown在进行downsampling是也是进行了5x5 Gaussian filter to low-pass 处理的。</p>
<h5 id="Applying-directional-filters-to-detect-edges"><a href="#Applying-directional-filters-to-detect-edges" class="headerlink" title="Applying directional filters to detect edges"></a>Applying directional filters to detect edges</h5><p>高通的滤波器一般用来检测变化比较大的区域，这里通过sobel函数，用于图像的边缘检测。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cv.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/imgcodecs.hpp&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv/cv.hpp&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">    cv::Mat image = cv::imread(<span class="string">"/home/shensir/Documents/MyPrograming/Cpp/Clions/data/lake.png"</span>, <span class="number">0</span>);</div><div class="line">    cv::imshow(<span class="string">"Original Image"</span>, image);</div><div class="line"></div><div class="line"></div><div class="line">    cv::Mat sobelX, sobelY;</div><div class="line">    cv::Sobel(image, sobelX, CV_8U, <span class="number">1</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">0.4</span>, <span class="number">128</span>);</div><div class="line">    cv::imshow(<span class="string">"SobelX Image"</span>, sobelX);</div><div class="line"></div><div class="line">    cv::Sobel(image, sobelY, CV_8U, <span class="number">0</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">0.4</span>, <span class="number">128</span>);</div><div class="line">    cv::imshow(<span class="string">"SobelY Image"</span>, sobelY);</div><div class="line"></div><div class="line">    <span class="comment">// Compute norm of Sobel</span></div><div class="line">    cv::Sobel(image, sobelX, CV_16S, <span class="number">1</span>, <span class="number">0</span>);</div><div class="line">    cv::Sobel(image, sobelY, CV_16S, <span class="number">0</span>, <span class="number">1</span>);</div><div class="line">    cv::Mat sobel;</div><div class="line">    <span class="comment">// compute the L1 norm</span></div><div class="line">    sobel = <span class="built_in">abs</span>(sobelX)+<span class="built_in">abs</span>(sobelY);</div><div class="line"></div><div class="line">    <span class="comment">// Find Sobel max value</span></div><div class="line">    <span class="keyword">double</span> sobmin, sobmax;</div><div class="line">    cv::minMaxLoc(sobel, &amp;sobmin, &amp;sobmax);</div><div class="line">    <span class="comment">// Conversion to 8-bit image</span></div><div class="line">    <span class="comment">// -alpha*sobel + 255</span></div><div class="line">    cv::Mat sobelImage;</div><div class="line">    sobel.convertTo(sobelImage,CV_8U, <span class="number">-255.</span>/sobmax, <span class="number">255</span>);</div><div class="line">    cv::imshow(<span class="string">"Sobel Image"</span>, sobelImage);</div><div class="line"></div><div class="line">    <span class="comment">// Binary Sobel Image(low)</span></div><div class="line">    cv::Mat sobeThreshold;</div><div class="line">    cv::threshold(sobelImage, sobeThreshold, <span class="number">230</span>, <span class="number">255</span>, cv::THRESH_BINARY);</div><div class="line">    cv::imshow(<span class="string">"Binary Sobel Image(low)"</span>, sobeThreshold);</div><div class="line"></div><div class="line">    cv::waitKey();</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div></pre></td></tr></table></figure>
<p>输出：<br><img src="http://blog-1252464519.costj.myqcloud.com/1705/Selection_052505.png" alt=""></p>
<h5 id="band-pass-filter"><a href="#band-pass-filter" class="headerlink" title="band-pass filter"></a>band-pass filter</h5><p>如果我们先应用高斯滤波器去除高频的部分，再用sobel filter去除低频的部分，那么我们就得到了一个band-filter. 我们只要在上面程序的开头加上一个高斯滤波即可查看效果：</p>
<p><code>cv::GaussianBlur(image, image, cv::Size(5,5), 1.5);</code></p>
<p>输出：<br><img src="http://blog-1252464519.costj.myqcloud.com/1705/Selection_052506.png" alt=""></p>
<h5 id="Computing-the-Laplacian-of-an-image"><a href="#Computing-the-Laplacian-of-an-image" class="headerlink" title="Computing the Laplacian of an image"></a>Computing the Laplacian of an image</h5><p>ps:这个公式推导不是很懂，所以暂时只是会用…</p>
<p>关于Laplacian:</p>
<blockquote>
<p>The Laplacian is another high-pass linear filter that is based on the computation of the image derivatives. As it will be explained, it computes second-order derivatives to measure the curvature of the image function.</p>
</blockquote>
<p>关于LOG：</p>
<blockquote>
<p>Since these larger kernels are computed using the second derivatives of the Gaussian function, the corresponding operator is often called Laplacian of Gaussian (LoG)</p>
</blockquote>
<p>由于高斯-拉普拉斯算子形状像一个草帽，所以又被称为“墨西哥草帽”</p>
<p>注意，拉氏算子是一种二阶导数算子，对图像中的噪声相对敏感，检测的边缘没有方向信息。因此，拉普拉斯算子很少直接用于检测边缘，而主要用于已知边缘像素后，确定图像的名区还是暗区。</p>
<p>关于DOG：</p>
<blockquote>
<p>. Now, if we subtract the two images that result from the filtering of an image by two Gaussian filters of different bandwidths, then the resulting image will be composed of those higher frequencies that one filter has preserved, and not the other. This operation is called Difference of Gaussians (DoG)</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cv.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/imgcodecs.hpp&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv/cv.hpp&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">class</span> LaplacianZC&#123;</div><div class="line"><span class="keyword">private</span>:</div><div class="line">    <span class="comment">// laplacina</span></div><div class="line">    cv::Mat laplace;</div><div class="line">    <span class="comment">// Aperture size of the laplacian kernel</span></div><div class="line">    <span class="keyword">int</span> aperture;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    LaplacianZC():aperture(<span class="number">3</span>)&#123;&#125;</div><div class="line"></div><div class="line">    <span class="comment">// Set the aperture size of the kernel</span></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setAperture</span><span class="params">(<span class="keyword">int</span> a)</span></span>&#123;</div><div class="line">        aperture = a;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// Compute the floating point Laplacian</span></div><div class="line">    cv::<span class="function">Mat <span class="title">computeLaplacian</span><span class="params">(<span class="keyword">const</span> cv::Mat&amp; image)</span></span>&#123;</div><div class="line">        <span class="comment">// Compute Laplacian</span></div><div class="line">        cv::Laplacian(image, laplace, CV_32F, aperture);</div><div class="line">        <span class="keyword">return</span> laplace;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// Get the Laplacian result in 8-bits image</span></div><div class="line">    <span class="comment">// zero corresponds to gray level 128</span></div><div class="line">    <span class="comment">// if no scale is provide, then the max value will be</span></div><div class="line">    <span class="comment">// scaled to intensity 255</span></div><div class="line">    <span class="comment">// You must call cimputeLaplacianImage before calling this</span></div><div class="line">    cv::<span class="function">Mat <span class="title">getLaplacianImage</span><span class="params">(<span class="keyword">double</span> scale=<span class="number">-1.0</span>)</span></span>&#123;</div><div class="line">        <span class="keyword">if</span>(scale&lt;<span class="number">0</span>)&#123;</div><div class="line">            <span class="keyword">double</span> lapmin, lapmax;</div><div class="line">            <span class="comment">// get min and max laplacian values</span></div><div class="line">            cv::minMaxLoc(laplace, &amp;lapmin, &amp;lapmax);</div><div class="line">            <span class="comment">// scale the laplacian to 127</span></div><div class="line">            scale = <span class="number">127</span>/<span class="built_in">std</span>::max(-lapmin, lapmax);</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// produce gray-level image</span></div><div class="line">        cv::Mat laplaceImage;</div><div class="line">        laplace.convertTo(laplaceImage, CV_8U, scale, <span class="number">128</span>);</div><div class="line">        <span class="keyword">return</span> laplaceImage;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//Get a binary image of the zero-crossings</span></div><div class="line">    <span class="comment">// laplacian image should be CV_32F</span></div><div class="line">    cv::<span class="function">Mat <span class="title">getZeroCrossings</span><span class="params">(cv::Mat laplace)</span></span>&#123;</div><div class="line">        <span class="comment">// threshold at 0</span></div><div class="line">        <span class="comment">// negtive values in black</span></div><div class="line">        <span class="comment">// positive values in white</span></div><div class="line">        cv::Mat signImage;</div><div class="line">        cv::threshold(laplace, signImage, <span class="number">0</span>, <span class="number">255</span>, cv::THRESH_BINARY);</div><div class="line"></div><div class="line">        <span class="comment">// convert the +/- image into CV_8U</span></div><div class="line">        cv::Mat binary;</div><div class="line">        signImage.convertTo(binary, CV_8U);</div><div class="line">        <span class="comment">// dilate the binary image of +/- regions</span></div><div class="line">        cv::Mat dilated;</div><div class="line">        cv::dilate(binary, dilated, cv::Mat());</div><div class="line"></div><div class="line">        <span class="comment">// return the zero-crossing contours</span></div><div class="line">        <span class="keyword">return</span> dilated-binary;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">    cv::Mat image = cv::imread(<span class="string">"/home/shensir/Documents/MyPrograming/Cpp/Clions/data/lake.png"</span>, <span class="number">0</span>);</div><div class="line">    cv::imshow(<span class="string">"Original"</span>, image);</div><div class="line">    <span class="comment">// Compute Laplcian using LaplacianZC class</span></div><div class="line">    LaplacianZC laplacian;</div><div class="line">    laplacian.setAperture(<span class="number">7</span>); <span class="comment">// 7x7 laplacian</span></div><div class="line">    cv::Mat flap = laplacian.computeLaplacian(image);</div><div class="line"></div><div class="line">    cv::Mat laplace;</div><div class="line">    laplace = laplacian.getLaplacianImage();</div><div class="line">    cv::imshow(<span class="string">"Laplacian Image 7x7"</span>, laplace);</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">// binary image of zero-crossing</span></div><div class="line">    cv::Mat Binary;</div><div class="line">    Binary = laplacian.getZeroCrossings(flap);</div><div class="line">    cv::imshow(<span class="string">"Binary"</span>, Binary);</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">// DoG</span></div><div class="line">    cv::Mat gauss20, gauss22;</div><div class="line">    cv::GaussianBlur(image, gauss20, cv::Size(), <span class="number">2.0</span>);</div><div class="line">    cv::GaussianBlur(image, gauss22, cv::Size(), <span class="number">2.2</span>);</div><div class="line"></div><div class="line">    <span class="comment">// compute a difference of Gaussians</span></div><div class="line">    cv::Mat dog;</div><div class="line">    cv::subtract(gauss22, gauss20, dog, cv::Mat(), CV_32F);</div><div class="line"></div><div class="line">    <span class="comment">// compute the zero-crossings of DoG</span></div><div class="line">    cv::Mat zeros;</div><div class="line">    zeros = laplacian.getZeroCrossings(dog);</div><div class="line">    cv::imshow(<span class="string">"DoG"</span>,zeros);</div><div class="line"></div><div class="line">    cv::waitKey();</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"></div></pre></td></tr></table></figure>
<p>输出：</p>
<p><img src="http://blog-1252464519.costj.myqcloud.com/1705/Selection_052508.png" alt=""></p>
<h4 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h4><p><em>《数字图像处理》高教出版社</em></p>

      
    </div>

    <div>
      
        
<div class="my_post_copyright">
  <script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>
  
  <!-- JS库 sweetalert 可修改路径 -->
  <script type="text/javascript" src="http://jslibs.wuxubj.cn/sweetalert_mini/jquery-1.7.1.min.js"></script>
  <script src="http://jslibs.wuxubj.cn/sweetalert_mini/sweetalert.min.js"></script>
  <link rel="stylesheet" type="text/css" href="http://jslibs.wuxubj.cn/sweetalert_mini/sweetalert.mini.css">
  <p><span>本文标题:</span><a href="/2017/05/25/OpenCV系列笔记二十二：滤波/">OpenCV系列笔记二十二：滤波</a></p>
  <p><span>文章作者:</span><a href="/" title="访问 不秩稚童 的个人博客">不秩稚童</a></p>
  <p><span>作者邮箱:</span>datahonor@gmail.com</p>
  <p><span>发布时间:</span>2017年05月25日 - 15:05</p>
  <p><span>最后更新:</span>2017年05月25日 - 18:05</p>
  <p><span>原始链接:</span><a href="/2017/05/25/OpenCV系列笔记二十二：滤波/" title="OpenCV系列笔记二十二：滤波">http://datahonor.com/2017/05/25/OpenCV系列笔记二十二：滤波/</a>
    <span class="copy-path"  title="点击复制文章链接"><i class="fa fa-clipboard" data-clipboard-text="http://datahonor.com/2017/05/25/OpenCV系列笔记二十二：滤波/"  aria-label="复制成功！"></i></span>
  </p>
  <p><span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">署名-非商业性使用-禁止演绎 4.0 国际</a> 转载请保留原文链接及作者。</p>  
</div>
<script> 
    var clipboard = new Clipboard('.fa-clipboard');
	clipboard.on('success', $(function(){
	  $(".fa-clipboard").click(function(){
		swal({   
		  title: "",   
		  text: '复制成功',   
		  html: false,
		  timer: 500,   
		  showConfirmButton: false
	    });
	  });
    }));  
</script>


      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>


    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Cpp/" rel="tag"># Cpp</a>
          
            <a href="/tags/OpenCV/" rel="tag"># OpenCV</a>
          
        </div>
      

      
        
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/05/25/OpenCV系列笔记二十一：MSER/" rel="next" title="OpenCV系列笔记二十一：MSER">
                <i class="fa fa-chevron-left"></i> OpenCV系列笔记二十一：MSER
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/05/27/Extracting-Lines-Contours-and-Components/" rel="prev" title="OpenCV系列笔记二十三：Extracting Lines, Contours, and Components">
                OpenCV系列笔记二十三：Extracting Lines, Contours, and Components <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
        
<script>
  with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='//bdimg.share.baidu.com/static/api/js/share.js?cdnversion='+~(-new Date()/36e5)];
</script>

      
    </div>
  </div>

          
          </div>
          


          
  <div class="comments" id="comments">

    
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    
  </div>









        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="https://avatars2.githubusercontent.com/u/17157965?v=3&u=1787d5d04d50967c7825062bfff705ee584ae2b2&s=400"
               alt="不秩稚童" />
          <p class="site-author-name" itemprop="name">不秩稚童</p>
           
              <p class="site-description motion-element" itemprop="description">十年饮冰，难凉热血。</p>
          
        </div>
        <nav class="site-state motion-element">
        
          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">88</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">10</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">26</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/shenxiangzhuang" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.zhihu.com/people/shen-xiang-zhuang" target="_blank" title="知乎">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  知乎
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.cnblogs.com/buzhizhitong" target="_blank" title="博客园">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  博客园
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-4"><a class="nav-link" href="#Overview"><span class="nav-text">Overview</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Code"><span class="nav-text">Code</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Downsampling-images-with-filters"><span class="nav-text">Downsampling images with filters</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Applying-directional-filters-to-detect-edges"><span class="nav-text">Applying directional filters to detect edges</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#band-pass-filter"><span class="nav-text">band-pass filter</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Computing-the-Laplacian-of-an-image"><span class="nav-text">Computing the Laplacian of an image</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Reference"><span class="nav-text">Reference</span></a></li></ol></div>
            


          </div>
        </section>
      <!--/noindex-->
      

      


    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">不秩稚童</span>
</div>



        

<div class="busuanzi-count">

  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv"><i class="fa fa-user"></i>本站访客数<span class="busuanzi-value" id="busuanzi_value_site_uv"></span>人次</span>
  

  
    <span class="site-pv"><i class="fa fa-eye"></i>本站总访问量<span class="busuanzi-value" id="busuanzi_value_site_pv"></span>次</span>
  
  
</div>



        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    
    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  

    <script type="text/javascript">
      var disqus_shortname = 'http-datahonor-com';
      var disqus_identifier = '2017/05/25/OpenCV系列笔记二十二：滤波/';

      var disqus_title = "OpenCV系列笔记二十二：滤波";


      function run_disqus_script(disqus_script) {
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      }

      run_disqus_script('count.js');

      
        var disqus_config = function () {
            this.page.url = disqus_url;
            this.page.identifier = disqus_identifier;
            this.page.title = disqus_title;
        };
        run_disqus_script('embed.js');
      

    </script>
  










  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
      search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();
    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';
      $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = $( "entry", xmlResponse ).map(function() {
            return {
              title: $( "title", this ).text(),
              content: $("content",this).text(),
              url: $( "url" , this).text()
            };
          }).get();
          var $input = document.getElementById(search_id);
          var $resultContent = document.getElementById(content_id);
          $input.addEventListener('input', function(){
            var matchcounts = 0;
            var str='<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length > 1) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var content_index = [];
                var data_title = data.title.trim().toLowerCase();
                var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                var data_url = decodeURIComponent(data.url);
                var index_title = -1;
                var index_content = -1;
                var first_occur = -1;
                // only match artiles with not empty titles and contents
                if(data_title != '') {
                  keywords.forEach(function(keyword, i) {
                    index_title = data_title.indexOf(keyword);
                    index_content = data_content.indexOf(keyword);
                    if( index_title >= 0 || index_content >= 0 ){
                      isMatch = true;
                      if (i == 0) {
                        first_occur = index_content;
                      }
                    }

                  });
                }
                // show search results
                if (isMatch) {
                  matchcounts += 1;
                  str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                  var content = data.content.trim().replace(/<[^>]+>/g,"");
                  if (first_occur >= 0) {
                    // cut out 100 characters
                    var start = first_occur - 20;
                    var end = first_occur + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if(start == 0){
                      end = 50;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    var match_content = content.substring(start, end);
                    // highlight all keywords
                    keywords.forEach(function(keyword){
                      var regS = new RegExp(keyword, "gi");
                      match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                    });

                    str += "<p class=\"search-result\">" + match_content +"...</p>"
                  }
                  str += "</li>";
                }
              })};
            str += "</ul>";
            if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
            if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
            $resultContent.innerHTML = str;
          });
          proceedsearch();
        }
      });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>


  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  


  
  <!-- 页面点击小红心 -->
  <script type="text/javascript" src="/js/src/love.js"></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->

</body>
</html>
