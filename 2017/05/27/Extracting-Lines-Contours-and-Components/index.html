<!DOCTYPE html>












  


<html class="theme-next gemini use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">


























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.0.0">



  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.0.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/logo.png?v=7.0.0">








<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.0.0',
    sidebar: {"position":"right","display":"post","offset":12,"b2t":true,"scrollpercent":true,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="Overview我们这里介绍怎样从图像中抽取一些有用的特征来进行图像的分析。  In order to perform content-based analysis of an image, it is necessary toextract meaningful features from the collection of pixels that constitutethe image.  C">
<meta name="keywords" content="Cpp">
<meta property="og:type" content="article">
<meta property="og:title" content="OpenCV系列笔记二十三：Extracting Lines, Contours, and Components">
<meta property="og:url" content="http://datahonor.com/2017/05/27/Extracting-Lines-Contours-and-Components/index.html">
<meta property="og:site_name" content="DATA HONOR">
<meta property="og:description" content="Overview我们这里介绍怎样从图像中抽取一些有用的特征来进行图像的分析。  In order to perform content-based analysis of an image, it is necessary toextract meaningful features from the collection of pixels that constitutethe image.  C">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://blog-1252464519.costj.myqcloud.com/1705/Selection_052701.png">
<meta property="og:image" content="http://blog-1252464519.costj.myqcloud.com/1705/Selection_052804.png">
<meta property="og:image" content="http://datahonor-1252464519.costj.myqcloud.com/201705/Detected%20Circles_052901.png">
<meta property="og:image" content="http://datahonor-1252464519.costj.myqcloud.com/201705/Selection_052902.png">
<meta property="og:image" content="http://datahonor-1252464519.costj.myqcloud.com/201705/Selection_052903.png">
<meta property="og:image" content="http://datahonor-1252464519.costj.myqcloud.com/201705/Selection_052904.png">
<meta property="og:updated_time" content="2017-05-29T08:10:30.146Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="OpenCV系列笔记二十三：Extracting Lines, Contours, and Components">
<meta name="twitter:description" content="Overview我们这里介绍怎样从图像中抽取一些有用的特征来进行图像的分析。  In order to perform content-based analysis of an image, it is necessary toextract meaningful features from the collection of pixels that constitutethe image.  C">
<meta name="twitter:image" content="http://blog-1252464519.costj.myqcloud.com/1705/Selection_052701.png">






  <link rel="canonical" href="http://datahonor.com/2017/05/27/Extracting-Lines-Contours-and-Components/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>OpenCV系列笔记二十三：Extracting Lines, Contours, and Components | DATA HONOR</title>
  






  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?cbfd16620150a28ce4061f717038b4de";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>







  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript><!-- hexo-inject:begin --><!-- hexo-inject:end -->

</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-right page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">DATA HONOR</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <h1 class="site-subtitle" itemprop="description">Pain Is Inevitable; Suffering Is Optional</h1>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://datahonor.com/2017/05/27/Extracting-Lines-Contours-and-Components/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="不秩稚童">
      <meta itemprop="description" content="十年饮冰，难凉热血。">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DATA HONOR">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">OpenCV系列笔记二十三：Extracting Lines, Contours, and Components

              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2017-05-27 09:01:01" itemprop="dateCreated datePublished" datetime="2017-05-27T09:01:01+08:00">2017-05-27</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2017-05-29 16:10:30" itemprop="dateModified" datetime="2017-05-29T16:10:30+08:00">2017-05-29</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/Cpp/" itemprop="url" rel="index"><span itemprop="name">Cpp</span></a></span>

                
                
              
            </span>
          

          
            
            
              
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <a href="/2017/05/27/Extracting-Lines-Contours-and-Components/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">评论数：</span> <span class="post-comments-count valine-comment-count" data-xid="/2017/05/27/Extracting-Lines-Contours-and-Components/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="post-meta-item-icon">
            <i class="fa fa-eye"></i>
             阅读次数： 
            <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>
            </span>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h4 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h4><p>我们这里介绍怎样从图像中抽取一些有用的特征来进行图像的分析。</p>
<blockquote>
<p>In order to perform content-based analysis of an image, it is necessary to<br>extract meaningful features from the collection of pixels that constitute<br>the image.</p>
</blockquote>
<h4 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h4><h5 id="Find-contours-by-Canny-operator"><a href="#Find-contours-by-Canny-operator" class="headerlink" title="Find contours by Canny operator"></a>Find contours by Canny operator</h5><p>之前，我们也简单介绍了基于梯度的图像的边缘检测，但是有两个缺点：第一是边缘有些厚，第二用于分割的阀值很难找到。所以我们这里介绍Canny算子。</p>
<p>原理部分，参考<a href="http://docs.opencv.org/2.4/doc/tutorials/imgproc/imgtrans/canny_detector/canny_detector.html" target="_blank" rel="noopener">文档</a>,写的很精彩。主要就是Non-maximum suppression和Hysteresis threshold的理解。</p>
<p>一个简单的demo:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cv.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/imgcodecs.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv/cv.hpp&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cv::Mat image = cv::imread(<span class="string">"/home/shensir/Documents/MyPrograming/Cpp/Clions/data/road.jpg"</span>, <span class="number">0</span>);</span><br><span class="line">    cv::namedWindow(<span class="string">"Original Image"</span>);</span><br><span class="line">    cv::imshow(<span class="string">"Original Image"</span>, image);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Apply Canny algorithm</span></span><br><span class="line">    cv::Mat contours;</span><br><span class="line">    cv::Canny(image, contours, <span class="number">125</span>, <span class="number">350</span>);  <span class="comment">// contours &#123;0,255&#125;,边缘为255</span></span><br><span class="line">    cv::namedWindow(<span class="string">"Canny Image"</span>);</span><br><span class="line">    <span class="comment">// 为了便于观察，取反色</span></span><br><span class="line">    cv::imshow(<span class="string">"Canny Image"</span>, <span class="number">255</span>-contours);</span><br><span class="line"></span><br><span class="line">    cv::waitKey();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>输出：</p>
<p><img src="http://blog-1252464519.costj.myqcloud.com/1705/Selection_052701.png" alt=""></p>
<p>除此之外，我们也可以通过pyrUp去除一些细节再进行边缘检测，效果会更好些。参考<a href="http://datahonor.com/2017/02/23/OpenCV-Pyramid-and-Canny/">这里</a></p>
<h5 id="Detecting-lines-in-images-with-the-Hough-transform"><a href="#Detecting-lines-in-images-with-the-Hough-transform" class="headerlink" title="Detecting lines in images with the Hough transform"></a>Detecting lines in images with the Hough transform</h5><p>关于霍夫变换的简单的demo，可以看下<a href="http://datahonor.com/2017/05/28/Hough%E5%8F%98%E6%8D%A2/">这里</a>. 这里，我们使用其进行检测图像中的直线。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cv.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/imgcodecs.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv/cv.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PI 3.1415926</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    cv::Mat image = cv::imread(<span class="string">"/home/shensir/Documents/MyPrograming/Cpp/Clions/data/road.jpg"</span>, <span class="number">0</span>);</span><br><span class="line">    cv::imshow(<span class="string">"Original Image"</span>, image);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Apply Canny algotithm</span></span><br><span class="line">    cv::Mat contours;</span><br><span class="line">    cv::Canny(image, contours, <span class="number">125</span>, <span class="number">350</span>);</span><br><span class="line">    cv::imshow(<span class="string">"Contours"</span>, contours);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Hough transfrom for line detection</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::Vec2f&gt;lines;</span><br><span class="line">    cv::HoughLines(contours, lines, <span class="number">1</span>, PI/<span class="number">180</span>, <span class="number">60</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::Vec2f&gt;::const_iterator it = lines.begin();</span><br><span class="line">    <span class="keyword">while</span>(it != lines.end())&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">float</span> rho = (*it)[<span class="number">0</span>];  <span class="comment">// first element is distance rho</span></span><br><span class="line">        <span class="keyword">float</span> theta = (*it)[<span class="number">1</span>];  <span class="comment">// second element is angle theta</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(theta &lt; PI/<span class="number">4.</span> || theta &gt; <span class="number">3.</span>*PI/<span class="number">4</span>)&#123;</span><br><span class="line">            <span class="comment">// vertical line</span></span><br><span class="line">            <span class="comment">// point of intersection of the line with first row</span></span><br><span class="line">            cv::Point pt1(rho/cos(theta), 0);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// point of intersection of the line with last row</span></span><br><span class="line">            cv::Point pt2((rho-image.rows*sin(theta))/cos(theta), image.rows);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// draw white line</span></span><br><span class="line">            cv::line(image, pt1, pt2, cv::Scalar(<span class="number">255</span>), <span class="number">1</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">// horizontal line</span></span><br><span class="line">            <span class="comment">// point of intersection of the line with first column</span></span><br><span class="line">            cv::Point pt1(<span class="number">0</span>, rho/<span class="built_in">sin</span>(theta));</span><br><span class="line">            <span class="comment">// point of intersection of the line with last column</span></span><br><span class="line">            cv::Point pt2(image.cols, (rho-image.cols*cos(theta))/sin(theta));</span><br><span class="line">            <span class="comment">// draw white line</span></span><br><span class="line">            cv::line(image, pt1, pt2, cv::Scalar(<span class="number">255</span>), <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        ++it;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    cv::imshow(<span class="string">"Image"</span>, image);</span><br><span class="line">    cv::waitKey();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>输出：</p>
<p><img src="http://blog-1252464519.costj.myqcloud.com/1705/Selection_052804.png" alt=""></p>
<p>同样地，只要可以将图像中的形状转化到参数空间，我们都可以用hough变换进行检测，比如圆形的检测：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cv.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/imgcodecs.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv/cv.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PI 3.1415926</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    cv::Mat image = cv::imread(<span class="string">"/home/shensir/Documents/MyPrograming/Cpp/Clions/data/chariot.jpg"</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="comment">// Detecting circles</span></span><br><span class="line">    cv::GaussianBlur(image, image, cv::Size(<span class="number">5</span>, <span class="number">5</span>), <span class="number">1.5</span>);</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::Vec3f&gt;circles;</span><br><span class="line">    cv::HoughCircles(image, circles, cv::HOUGH_GRADIENT,</span><br><span class="line">                    <span class="number">2</span>, <span class="comment">// accumulator resolution(size of the image/2)</span></span><br><span class="line">                    <span class="number">20</span>, <span class="comment">// minimum distance between two circles</span></span><br><span class="line">                    <span class="number">200</span>, <span class="comment">// Canny high threshold</span></span><br><span class="line">                    <span class="number">60</span>, <span class="comment">// minimum number of vates</span></span><br><span class="line">                    <span class="number">15</span>,</span><br><span class="line">                    <span class="number">50</span>);  <span class="comment">// min and max radius</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::Vec3f&gt;::const_iterator itc = circles.begin();</span><br><span class="line">    <span class="keyword">while</span>(itc!=circles.end())&#123;</span><br><span class="line">        cv::circle(image, cv::Point((*itc)[<span class="number">0</span>], (*itc)[<span class="number">1</span>]), (*itc)[<span class="number">2</span>], cv::Scalar(<span class="number">255</span>), <span class="number">2</span>);</span><br><span class="line">        ++itc;</span><br><span class="line">    &#125;</span><br><span class="line">    cv::namedWindow(<span class="string">"Detected Circles"</span>);</span><br><span class="line">    cv::imshow(<span class="string">"Detected Circles"</span>, image);</span><br><span class="line"></span><br><span class="line">    cv::waitKey();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>输出:<br><img src="http://datahonor-1252464519.costj.myqcloud.com/201705/Detected%20Circles_052901.png" alt=""></p>
<p>基于上面的应用，我们来学习下关于Probabilistic Hough transform的应用：</p>
<blockquote>
<p>As can be seen, the Hough transform simply looks for an alignment of edge pixels across the image. This can potentially create some false detections due to incidental pixel alignments or multiple detections when several lines with slightly different parameter values pass through the same alignment of pixels.<br>To overcome some of these problems, and to allow line segments to be detected (that is, with endpoints), a variant of the transform has been proposed. This is the Probabilistic Hough transform, and it is implemented in OpenCV as the cv::HoughLinesP function. </p>
</blockquote>
<p><strong>linefinder.h</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Created by shensir on 17-4-21.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/core.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/imgproc.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PI 3.1415926</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> CLIONS_LINEFINDER_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> CLIONS_LINEFINDER_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">//CLIONS_LINEFINDER_H</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> LineFinder&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="comment">// orginal image</span></span><br><span class="line">    cv::Mat img;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// vector containing the endpoints of the detected lines</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::Vec4i&gt;lines;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// accumulator resolution parameters</span></span><br><span class="line">    <span class="keyword">double</span> deltaRHo;</span><br><span class="line">    <span class="keyword">double</span> deltaTheta;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// minimum number of votes that a line</span></span><br><span class="line">    <span class="comment">// must receive before being considered</span></span><br><span class="line">    <span class="keyword">int</span> minVote;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// min length for a line</span></span><br><span class="line">    <span class="keyword">double</span> minLength;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// max allowed gap along the line</span></span><br><span class="line">    <span class="keyword">double</span> maxGap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// Default accumulator resolution is 1 pixel by 1 degree</span></span><br><span class="line">    <span class="comment">// no gap, no minimum length</span></span><br><span class="line">    LineFinder():deltaRHo(<span class="number">1</span>), deltaTheta(PI/<span class="number">180</span>),</span><br><span class="line">                 minVote(<span class="number">10</span>), minLength(<span class="number">0.</span>), maxGap(<span class="number">0.</span>)&#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Set the resolution of the accumulator</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setAccResolution</span><span class="params">(<span class="keyword">double</span> dRho, <span class="keyword">double</span> dTheta)</span></span>&#123;</span><br><span class="line">        deltaRHo = dRho;</span><br><span class="line">        deltaTheta = dTheta;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Set the minimum member of votes</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setMinVote</span><span class="params">(<span class="keyword">int</span> minv)</span></span>&#123;</span><br><span class="line">        minVote = minv;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Set line length and gap</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setLineLengthAndGap</span><span class="params">(<span class="keyword">double</span> length, <span class="keyword">double</span> gap)</span></span>&#123;</span><br><span class="line">        minLength = length;</span><br><span class="line">        maxGap = gap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Apply probabilistic Hough Transform</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::Vec4i&gt;findLines(cv::Mat&amp;binary)&#123;</span><br><span class="line">        lines.clear();</span><br><span class="line">        cv::HoughLinesP(binary, lines, deltaRHo, deltaTheta, minVote,</span><br><span class="line">                        minLength, maxGap);</span><br><span class="line">        <span class="keyword">return</span> lines;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Draw the detected lines on an image</span></span><br><span class="line">    void drawDetectedLines(cv::Mat &amp;image, cv::Scalar color=cv::Scalar(255,255,255))&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Draw lines</span></span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::Vec4i&gt;::const_iterator it2 = lines.begin();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(it2!=lines.end())&#123;</span><br><span class="line">            cv::Point pt1((*it2)[0], (*it2)[1]);</span><br><span class="line">            cv::Point pt2((*it2)[2], (*it2)[3]);</span><br><span class="line"></span><br><span class="line">            cv::line(image, pt1, pt2, color);</span><br><span class="line">            ++it2;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>main.cpp</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#include &lt;cv.h&gt;</span><br><span class="line">#include &lt;opencv2/imgcodecs.hpp&gt;</span><br><span class="line">#include &lt;opencv/cv.hpp&gt;</span><br><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include &quot;linefinder.h&quot;</span><br><span class="line">#define PI 3.1415926</span><br><span class="line"></span><br><span class="line">using namespace std</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">int main() &#123;</span><br><span class="line">    cv::Mat image = cv::imread(&quot;/home/shensir/Documents/MyPrograming/Cpp/Clions/data/road.jpg&quot;, 0);</span><br><span class="line">    cv::imshow(&quot;Original Image&quot;, image);</span><br><span class="line"></span><br><span class="line">    // Apply Canny algotithm</span><br><span class="line">    cv::Mat contours;</span><br><span class="line">    cv::Canny(image, contours, 125, 350);</span><br><span class="line">    cv::imshow(&quot;Contours&quot;, contours);</span><br><span class="line"></span><br><span class="line">        // Create LineFinder instance</span><br><span class="line">    LineFinder finder;</span><br><span class="line"></span><br><span class="line">    // Set probabilistic Hough parameters</span><br><span class="line">    finder.setLineLengthAndGap(100, 20);</span><br><span class="line">    finder.setMinVote(60);</span><br><span class="line"></span><br><span class="line">    // Detect lines and draw them in the image</span><br><span class="line">    std::vector&lt;cv::Vec4i&gt;lines = finder.findLines(contours);</span><br><span class="line">    finder.drawDetectedLines(image);</span><br><span class="line"></span><br><span class="line">    cv::namedWindow(&quot;Lines with HoughP&quot;);</span><br><span class="line">    cv::imshow(&quot;Lines with HoughP&quot;, image);</span><br><span class="line"></span><br><span class="line">    cv::waitKey();</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>输出：<br><img src="http://datahonor-1252464519.costj.myqcloud.com/201705/Selection_052902.png" alt=""></p>
<h5 id="Extracting-connected-components-amp-amp-Computing-components’-shape-descriptors"><a href="#Extracting-connected-components-amp-amp-Computing-components’-shape-descriptors" class="headerlink" title="Extracting connected components &amp;&amp; Computing components’ shape descriptors"></a>Extracting connected components &amp;&amp; Computing components’ shape descriptors</h5><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cv.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/imgcodecs.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv/cv.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PI 3.1415926</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Eliminate too short or too long contours</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">BalanceLength</span><span class="params">(<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::Point&gt;&gt;&amp; contours)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> cmin = <span class="number">80</span>;  <span class="comment">// minimum contour length</span></span><br><span class="line">    <span class="keyword">int</span> cmax = <span class="number">500</span>;  <span class="comment">// maximum contours length</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::Point&gt;&gt;::iterator itc = contours.begin();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// for all contours</span></span><br><span class="line">    <span class="keyword">while</span>( itc != contours.end())&#123;</span><br><span class="line">        <span class="comment">// verify contour size</span></span><br><span class="line">        <span class="keyword">if</span>(itc-&gt;size() &lt; cmin || itc-&gt;size() &gt; cmax)</span><br><span class="line">            itc = contours.erase(itc);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            ++itc;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    cv::Mat image = cv::imread(<span class="string">"/home/shensir/Documents/MyPrograming/Cpp/Clions/data/marphimg.png"</span>, <span class="number">0</span>);</span><br><span class="line">    cv::imshow(<span class="string">"Original Image"</span>, image);</span><br><span class="line">    <span class="comment">// the vector that will contain the contours</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::Point&gt;&gt; contours;</span><br><span class="line">    cv::findContours(image,</span><br><span class="line">                    contours,   <span class="comment">// a vector og contours</span></span><br><span class="line">                    cv::RETR_EXTERNAL,  <span class="comment">//retieve the external contours</span></span><br><span class="line">                    cv::CHAIN_APPROX_NONE);  <span class="comment">// all pixels of each contours</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// draw black contours on a white image</span></span><br><span class="line">    cv::Mat result(image.size(), CV_8U, cv::Scalar(255));</span><br><span class="line">    cv::drawContours(result, contours, <span class="number">-1</span>, <span class="number">0</span>, <span class="number">2</span>); <span class="comment">// draw all contours; in black; with a thickness of 2</span></span><br><span class="line">    cv::imshow(<span class="string">"result_before_elimination"</span>, result);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Eliminate too short or too long contours</span></span><br><span class="line">    BalanceLength(contours);</span><br><span class="line"></span><br><span class="line">    cv::Mat result1(image.size(), CV_8U, cv::Scalar(255));</span><br><span class="line">    cv::drawContours(result1, contours, <span class="number">-1</span>, <span class="number">0</span>, <span class="number">2</span>); <span class="comment">// draw all contours; in black; with a thickness of 2</span></span><br><span class="line">    cv::imshow(<span class="string">"result_after_elimination"</span>, result1);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// testing the bounding box</span></span><br><span class="line">    cv::Rect r0 = cv::boundingRect(contours[<span class="number">0</span>]);</span><br><span class="line">    <span class="comment">// draw the rectangle</span></span><br><span class="line">    cv::rectangle(result1, r0, <span class="number">0</span>, <span class="number">2</span>);</span><br><span class="line">    cv::imshow(<span class="string">"boundingbox"</span>, result1);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// testing the enclosing circle</span></span><br><span class="line">    <span class="keyword">float</span> radius;</span><br><span class="line">    cv::Point2f center;</span><br><span class="line">    cv::minEnclosingCircle(contours[<span class="number">1</span>],center,radius);</span><br><span class="line">    <span class="comment">// draw the cricle</span></span><br><span class="line">    cv::circle(result1,center,<span class="keyword">static_cast</span>&lt;<span class="keyword">int</span>&gt;(radius), cv::Scalar(<span class="number">0</span>), <span class="number">2</span>);</span><br><span class="line">    cv::imshow(<span class="string">"enclosing"</span>, result1);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// testing the approximate polygon</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::Point&gt; poly;</span><br><span class="line">    cv::approxPolyDP(contours[<span class="number">2</span>], poly, <span class="number">5</span>, <span class="literal">true</span>);</span><br><span class="line">    <span class="comment">// draw the polygon</span></span><br><span class="line">    cv::polylines(result1, poly, <span class="literal">true</span>, <span class="number">0</span>, <span class="number">2</span>);</span><br><span class="line">    cv::imshow(<span class="string">"Poly"</span>, result1);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// testing the convex hull</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::Point&gt;hull;</span><br><span class="line">    cv::convexHull(contours[<span class="number">3</span>], hull);</span><br><span class="line">    <span class="comment">// draw the polygon</span></span><br><span class="line">    cv::polylines(result1, hull, <span class="literal">true</span>, <span class="number">0</span>, <span class="number">2</span>);</span><br><span class="line">    cv::imshow(<span class="string">"convexhull"</span>, result1);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// testing the moments</span></span><br><span class="line">    <span class="comment">// iterator over all contours</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::Point&gt;&gt;::iterator itc = contours.begin();</span><br><span class="line">    <span class="keyword">while</span>(itc!=contours.end())&#123;</span><br><span class="line">        <span class="comment">// compute all moments</span></span><br><span class="line">        cv::Moments mom = cv::moments(cv::Mat(*itc++));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// draw mess center</span></span><br><span class="line">        cv::circle(result1, cv::Point(mom.m10/mom.m00, mom.m01/mom.m00),</span><br><span class="line">        <span class="number">2</span>, cv::Scalar(<span class="number">0</span>), <span class="number">2</span>);  <span class="comment">// draw black dot</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    cv::imshow(<span class="string">"Moments"</span>, result1);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// original color image of cattles</span></span><br><span class="line">    cv::Mat colorImage  = cv::imread(<span class="string">"/home/shensir/Documents/MyPrograming/Cpp/Clions/data/cattle.png"</span>);</span><br><span class="line">    cv::imshow(<span class="string">"OriginalColorImage"</span>, colorImage);</span><br><span class="line"></span><br><span class="line">    cv::drawContours(colorImage, contours, <span class="number">-1</span>, cv::Scalar(<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>), <span class="number">2</span>); <span class="comment">// draw all contours; in black; with a thickness of 2</span></span><br><span class="line">    cv::imshow(<span class="string">"colorImage"</span>, colorImage);</span><br><span class="line"></span><br><span class="line">    cv::waitKey(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>输出：</p>
<p><img src="http://datahonor-1252464519.costj.myqcloud.com/201705/Selection_052903.png" alt=""></p>
<h5 id="Quadrilateral-detection"><a href="#Quadrilateral-detection" class="headerlink" title="Quadrilateral detection"></a>Quadrilateral detection</h5><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cv.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/imgcodecs.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv/cv.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PI 3.1415926</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cv::Mat components = cv::imread(<span class="string">"/home/shensir/Documents/MyPrograming/Cpp/Clions/data/mser.bmp"</span>, <span class="number">0</span>);</span><br><span class="line">    cv::imshow(<span class="string">"Raw Image"</span>, components);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// binary</span></span><br><span class="line">    components = components == <span class="number">255</span>;</span><br><span class="line">    cv::imshow(<span class="string">"Binary"</span>, components);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// open the image (white background)</span></span><br><span class="line">    <span class="comment">// clean the image with a morphological filter</span></span><br><span class="line">    cv::morphologyEx(components,components,</span><br><span class="line">                    cv::MORPH_OPEN, cv::Mat(),</span><br><span class="line">                    cv::Point(<span class="number">-1</span>,<span class="number">-1</span>), <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">    cv::imshow(<span class="string">"After bin-morph"</span>, components);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// invert image (background must be black)</span></span><br><span class="line">    cv::Mat componentsInv = <span class="number">255</span> - components;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get the contours of the connected components</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::Point&gt;&gt; contours;</span><br><span class="line">    cv::findContours(componentsInv, contours, cv::RETR_EXTERNAL,</span><br><span class="line">                    cv::CHAIN_APPROX_NONE);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// white image</span></span><br><span class="line">    cv::Mat quadri(components.size(), CV_8U, 255);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// for all contours</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::Point&gt;&gt;::iterator it = contours.begin();</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::Point&gt; poly;</span><br><span class="line">    <span class="keyword">while</span> (it != contours.end())&#123;</span><br><span class="line">        poly.clear();</span><br><span class="line">        cv::approxPolyDP(*it, poly, <span class="number">5</span>, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// do we have a quadrilateral?</span></span><br><span class="line">        <span class="keyword">if</span>(poly.size() == <span class="number">4</span>)  <span class="comment">//draw it</span></span><br><span class="line">            cv::polylines(quadri, poly, <span class="literal">true</span>, <span class="number">0</span>, <span class="number">2</span>);</span><br><span class="line">        ++it;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    cv::imshow(<span class="string">"Quadri"</span>, quadri);</span><br><span class="line">    cv::waitKey();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>输出：</p>
<p><img src="http://datahonor-1252464519.costj.myqcloud.com/201705/Selection_052904.png" alt=""></p>

      
    </div>

    
      


    

    
    
    
    <div>
          
	    
<div class="my_post_copyright">
  <script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>
  
  <!-- JS库 sweetalert 可修改路径 -->
  <script type="text/javascript" src="http://jslibs.wuxubj.cn/sweetalert_mini/jquery-1.7.1.min.js"></script>
  <script src="http://jslibs.wuxubj.cn/sweetalert_mini/sweetalert.min.js"></script>
  <link rel="stylesheet" type="text/css" href="http://jslibs.wuxubj.cn/sweetalert_mini/sweetalert.mini.css">

  <p><span>本文标题:</span>OpenCV系列笔记二十三：Extracting Lines, Contours, and Components</p>
  <p><span>文章作者:</span>不秩稚童</p>
  <p><span>发布时间:</span>2017年05月27日 - 09:01:01</p>
  <p><span>最后更新:</span>2017年05月29日 - 16:10:30</p>
  <p><span>原始链接:</span><a href="/2017/05/27/Extracting-Lines-Contours-and-Components/" title="OpenCV系列笔记二十三：Extracting Lines, Contours, and Components">http://datahonor.com/2017/05/27/Extracting-Lines-Contours-and-Components/</a>
    <span class="copy-path" title="点击复制文章链接"><i class="fa fa-clipboard" data-clipboard-text="http://datahonor.com/2017/05/27/Extracting-Lines-Contours-and-Components/" aria-label="复制成功！"></i></span>
  </p>
  <p><span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">署名-非商业性使用-禁止演绎 4.0 国际</a> 转载请保留原文链接及作者。</p>  
</div>
<script> 
    var clipboard = new Clipboard('.fa-clipboard');
    clipboard.on('success', $(function(){
      $(".fa-clipboard").click(function(){
        swal({   
          title: "",   
          text: '复制成功',   
          html: false,
          timer: 500,   
          showConfirmButton: false
        });
      });
    }));  
</script>


          
    </div>

    

    
      
    
    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>击蒙御寇</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/wechatpay.jpg" alt="不秩稚童 微信支付">
        <p>微信支付</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/images/alipay.jpg" alt="不秩稚童 支付宝">
        <p>支付宝</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Cpp/" rel="tag"># Cpp</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/05/25/OpenCV系列笔记二十二：滤波/" rel="next" title="OpenCV系列笔记二十二：滤波">
                <i class="fa fa-chevron-left"></i> OpenCV系列笔记二十二：滤波
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/05/28/Hough变换/" rel="prev" title="Hough变换">
                Hough变换 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  
    <div class="comments" id="comments">
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.gif" alt="不秩稚童">
            
              <p class="site-author-name" itemprop="name">不秩稚童</p>
              <p class="site-description motion-element" itemprop="description">十年饮冰，难凉热血。</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">164</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">21</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">62</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/shenxiangzhuang" title="GitHub &rarr; https://github.com/shenxiangzhuang" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="mailto:datahonor@gmail.com" title="E-Mail &rarr; mailto:datahonor@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
            </div>
          

          
             <div class="cc-license motion-element" itemprop="license">
              
                
              
              
              
              <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
             </div>
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                友情链接
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://yuanhang0.github.io/" title="https://yuanhang0.github.io/" rel="noopener" target="_blank">Tomorrow</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://yudaer.github.io/" title="http://yudaer.github.io/" rel="noopener" target="_blank">小白二号</a>
                  </li>
                
              </ul>
            </div>
          

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-4"><a class="nav-link" href="#Overview"><span class="nav-number">1.</span> <span class="nav-text">Overview</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Code"><span class="nav-number">2.</span> <span class="nav-text">Code</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Find-contours-by-Canny-operator"><span class="nav-number">2.1.</span> <span class="nav-text">Find contours by Canny operator</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Detecting-lines-in-images-with-the-Hough-transform"><span class="nav-number">2.2.</span> <span class="nav-text">Detecting lines in images with the Hough transform</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Extracting-connected-components-amp-amp-Computing-components’-shape-descriptors"><span class="nav-number">2.3.</span> <span class="nav-text">Extracting connected components &amp;&amp; Computing components’ shape descriptors</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Quadrilateral-detection"><span class="nav-number">2.4.</span> <span class="nav-text">Quadrilateral detection</span></a></li></ol></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2017 – <span itemprop="copyrightYear">2020</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">不秩稚童</span>
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  

  
</div>









        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="post-meta-item-icon">
      <i class="fa fa-user"></i>
    </span>
    <span class="site-uv" title="总访客量">
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
  

  
    <span class="post-meta-divider">|</span>
  

  
    <span class="post-meta-item-icon">
      <i class="fa fa-eye"></i>
    </span>
    <span class="site-pv" title="总访问量">
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
  
</div>









        
      </div>
    </footer>

    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/src/utils.js?v=7.0.0"></script>

  <script src="/js/src/motion.js?v=7.0.0"></script>



  
  


  <script src="/js/src/affix.js?v=7.0.0"></script>

  <script src="/js/src/schemes/pisces.js?v=7.0.0"></script>




  
  <script src="/js/src/scrollspy.js?v=7.0.0"></script>
<script src="/js/src/post-details.js?v=7.0.0"></script>



  


  <script src="/js/src/bootstrap.js?v=7.0.0"></script>



  
  

<script src="//cdn1.lncld.net/static/js/3.11.1/av-min.js"></script>



<script src="//unpkg.com/valine/dist/Valine.min.js"></script>

<script>
  var GUEST = ['nick', 'mail', 'link'];
  var guest = 'nick,mail';
  guest = guest.split(',').filter(function(item) {
    return GUEST.indexOf(item) > -1;
  });
  new Valine({
    el: '#comments',
    verify: true,
    notify: true,
    appId: 'qzF75hQvs6yPkMIO7gd7LwDB-gzGzoHsz',
    appKey: 'foULNoeGLTL8LE8C2Ysitv5I',
    placeholder: '毕竟今天太阳那么好~(评论时留下邮箱才能收到回复提醒的邮件哦)',
    avatar: 'mm',
    meta: guest,
    pageSize: '10' || 10,
    visitor: false
  });
</script>




  


  

  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  
  

  
  

  


  

  

  

  

  

  

  
  <style>
    .copy-btn {
      display: inline-block;
      padding: 6px 12px;
      font-size: 13px;
      font-weight: 700;
      line-height: 20px;
      color: #333;
      white-space: nowrap;
      vertical-align: middle;
      cursor: pointer;
      background-color: #eee;
      background-image: linear-gradient(#fcfcfc, #eee);
      border: 1px solid #d5d5d5;
      border-radius: 3px;
      user-select: none;
      outline: 0;
    }

    .highlight-wrap .copy-btn {
      transition: opacity .3s ease-in-out;
      opacity: 0;
      padding: 2px 6px;
      position: absolute;
      right: 4px;
      top: 8px;
    }

    .highlight-wrap:hover .copy-btn,
    .highlight-wrap .copy-btn:focus {
      opacity: 1
    }

    .highlight-wrap {
      position: relative;
    }
  </style>
  <script>
    $('.highlight').each(function(i, e) {
      var $wrap = $('<div>').addClass('highlight-wrap');
      $(e).after($wrap);
      $wrap.append($('<button>').addClass('copy-btn').append('复制').on('click', function(e) {
        var code = $(this).parent().find('.code').find('.line').map(function(i, e) {
          return $(e).text();
        }).toArray().join('\n');
        var ta = document.createElement('textarea');
        var range = document.createRange(); //For Chrome
        var sel = window.getSelection(); //For Chrome
        var yPosition = window.pageYOffset || document.documentElement.scrollTop;
        ta.style.top = yPosition + 'px'; //Prevent page scroll
        ta.style.position = 'absolute';
        ta.style.opacity = '0';
        ta.value = code;
        ta.textContent = code; //For FireFox
        ta.contentEditable = true;
        ta.readOnly = false;
        document.body.appendChild(ta);
        range.selectNode(ta);
        sel.removeAllRanges();
        sel.addRange(range);
        ta.setSelectionRange(0, code.length);
        var result = document.execCommand('copy');
        
        ta.blur(); //For iOS
        $(this).blur();
      })).on('mouseleave', function(e) {
        var $b = $(this).find('.copy-btn');
        setTimeout(function() {
          $b.text('复制');
        }, 300);
      }).append(e);
    })
  </script>


  

<script type="text/javascript" src="/js/src/love.js"></script>
<!-- 雪花特效 -->
<script type="text/javascript">
  var windowWidth = $(window).width();
  if (windowWidth > 480) {
    document.write('<script type="text/javascript" src="/js/src/snow.js"><\/script>');
  }
</script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
<script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"scale":1,"hHeadPos":0.5,"vHeadPos":0.618,"jsonPath":"/live2dw/assets/tia.model.json"},"display":{"superSample":2,"width":120,"height":120,"position":"left","hOffset":0,"vOffset":-20},"mobile":{"show":false,"scale":0.05},"react":{"opacityDefault":0.99,"opacityOnHover":0.2},"log":false});</script></body>
</html>
