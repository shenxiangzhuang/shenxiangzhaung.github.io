<!doctype html>





  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Cpp,OpenCV," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="Overview我们经常从图像像素点的直方图来获取一些数据，所以绘制直方图也是需要掌握的。

An image is made of pixels that have different values. For example, in a 1-channel gray-level image, each pixel has an integer value between 0 (black) an">
<meta property="og:type" content="article">
<meta property="og:title" content="OpenCV系列笔记十三：Computing an image histogram">
<meta property="og:url" content="http://datahonor.com/2017/05/02/Computing-an-image-histogram/index.html">
<meta property="og:site_name" content="DATA HONOR">
<meta property="og:description" content="Overview我们经常从图像像素点的直方图来获取一些数据，所以绘制直方图也是需要掌握的。

An image is made of pixels that have different values. For example, in a 1-channel gray-level image, each pixel has an integer value between 0 (black) an">
<meta property="og:image" content="http://blog-1252464519.costj.myqcloud.com/170502/hist1.png">
<meta property="og:image" content="http://blog-1252464519.costj.myqcloud.com/170502/hist2.png">
<meta property="og:image" content="http://datahonor.com/2017/05/02/Computing-an-image-histogram/">
<meta property="og:image" content="http://blog-1252464519.costj.myqcloud.com/170505/Selection_050511%3A02%3A11.png">
<meta property="og:image" content="http://blog-1252464519.costj.myqcloud.com/170505/Selection_050512%3A26%3A29.png">
<meta property="og:image" content="http://blog-1252464519.costj.myqcloud.com/170505/Selection_050501.png">
<meta property="og:image" content="http://blog-1252464519.costj.myqcloud.com/170505/Selection_050502.png">
<meta property="og:image" content="http://blog-1252464519.costj.myqcloud.com/170505/Selection_050503.png">
<meta property="og:image" content="http://blog-1252464519.costj.myqcloud.com/170505/cmphists.png">
<meta property="og:updated_time" content="2017-05-06T16:14:23.993Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="OpenCV系列笔记十三：Computing an image histogram">
<meta name="twitter:description" content="Overview我们经常从图像像素点的直方图来获取一些数据，所以绘制直方图也是需要掌握的。

An image is made of pixels that have different values. For example, in a 1-channel gray-level image, each pixel has an integer value between 0 (black) an">
<meta name="twitter:image" content="http://blog-1252464519.costj.myqcloud.com/170502/hist1.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"right","display":"always","offset":12,"offset_float":0,"b2t":false,"scrollpercent":true},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '不秩稚童'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://datahonor.com/2017/05/02/Computing-an-image-histogram/"/>





  <title> OpenCV系列笔记十三：Computing an image histogram | DATA HONOR </title><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  




<!-- hexo-inject:begin --><!-- hexo-inject:end --><script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-92663335-1', 'auto');
  ga('send', 'pageview');
</script>


  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?cbfd16620150a28ce4061f717038b4de";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>










  
  
    
  

  <div class="container one-collumn sidebar-position-right page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">DATA HONOR</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Never say never.</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocapitalize="off" autocomplete="off" autocorrect="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://datahonor.com/2017/05/02/Computing-an-image-histogram/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="不秩稚童">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/17157965?v=3&u=1787d5d04d50967c7825062bfff705ee584ae2b2&s=400">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="DATA HONOR">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="DATA HONOR" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                OpenCV系列笔记十三：Computing an image histogram
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-02T16:34:26+08:00">
                2017-05-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Cpp/" itemprop="url" rel="index">
                    <span itemprop="name">Cpp</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/05/02/Computing-an-image-histogram/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/05/02/Computing-an-image-histogram/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i>本文总阅读量
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>次
            </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h4 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h4><p>我们经常从图像像素点的直方图来获取一些数据，所以绘制直方图也是需要掌握的。</p>
<blockquote>
<p>An image is made of pixels that have different values. For example, in a 1-channel gray-level image, each pixel has an integer value between 0 (black) and 255 (white). Depending on the picture content, you will find different amounts of each gray shade laid out inside the image. A histogram is a simple table that gives you the number of pixels that have a given value in an image (or sometimes, a set of images). The histogram of a gray-level image will, therefore, have 256 entries (or bins). Bin 0 gives you the number of pixels that have the value 0, bin 1 gives you the number of pixels that have the value 1, and so on. Obviously, if you sum all of the entries of a histogram, you should get the total number of pixels. Histograms can also be normalized so that the sum of the bins equals 1. In this case, each bin gives you the percentage of pixels that have this specific value in the image.</p>
</blockquote>
<p>下面我们分别给出单通道[灰度图]和三通道图像直方图的绘制，前者来自这系列笔记的参考书，后者来自官方文档，其实基本思路是一致的。</p>
<h4 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h4><h5 id="单通道-灰度图"><a href="#单通道-灰度图" class="headerlink" title="单通道[灰度图]"></a>单通道[灰度图]</h5><h6 id="grayhistogram-h"><a href="#grayhistogram-h" class="headerlink" title="grayhistogram.h"></a>grayhistogram.h</h6><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">#ifndef CLIONS_GRAYHISTOGRAM_H</div><div class="line">#define CLIONS_GRAYHISTOGRAM_H</div><div class="line"></div><div class="line">#include &lt;cv.h&gt;</div><div class="line">#include &lt;highgui.h&gt;</div><div class="line">#include &lt;opencv2/imgcodecs.hpp&gt;</div><div class="line">#include &lt;opencv/cv.hpp&gt;</div><div class="line"></div><div class="line">class Histogram1D&#123;</div><div class="line">private:</div><div class="line">    int histSize[1]; // numbers of bins in histogram</div><div class="line">    float hranges[2];  // range of values</div><div class="line">    const float* ranges[1];  // pointer to the value ranges</div><div class="line">    int channels[1]; // channel number to be examined</div><div class="line">public:</div><div class="line">    Histogram1D()&#123;</div><div class="line">        // Prepare default arguments for 1D histogram</div><div class="line">        histSize[0] = 256;  // 256bins</div><div class="line">        hranges[0] = 0.0;  // from 0 (inclusive)</div><div class="line">        hranges[1] = 256.0;  // to 256 (exclusive)</div><div class="line">        ranges[0] = hranges;</div><div class="line">        channels[0] = 0; // we look at channel 0</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    void setNBins(int size)&#123;</div><div class="line">        histSize[0] = size;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    // Computes the 1D histogram</div><div class="line">    cv::Mat getHistogram(const cv::Mat &amp;image)&#123;</div><div class="line">        cv::Mat hist;</div><div class="line">        //Compute 1D histogram with calcHist</div><div class="line">        cv::calcHist(&amp;image,1,channels,cv::Mat(),</div><div class="line">                     hist, 1, histSize, ranges);</div><div class="line">        return  hist;</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    // Compute the 1D histogram and returns an image of it</div><div class="line">    cv::Mat getHistogramImage(const cv::Mat &amp;image, int zoom=1)&#123;</div><div class="line">        // Compute histogram first</div><div class="line">        cv::Mat hist = getHistogram(image);</div><div class="line">        // Create imaeg</div><div class="line">        return getImageOfHistogram(hist, zoom);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    // Create an image representing a histogram (static method)</div><div class="line">    static cv::Mat getImageOfHistogram(const cv::Mat &amp;hist, int zoom)&#123;</div><div class="line">        // Get min and max bin values</div><div class="line">        double maxVal = 0;</div><div class="line">        double minVal = 0;</div><div class="line">        cv::minMaxLoc(hist, &amp;minVal, &amp;maxVal, 0, 0);</div><div class="line"></div><div class="line">        //get histogram size</div><div class="line">        int histSize = hist.rows;</div><div class="line"></div><div class="line">        //Square image on which to display histogram</div><div class="line">        cv::Mat histImg(histSize*zoom, histSize*zoom, CV_8U, cv::Scalar(255));</div><div class="line">        // set highest point at 90% of nbins (i.e. image height)</div><div class="line">        int hpt = static_cast&lt;int&gt;(0.9*histSize);</div><div class="line"></div><div class="line">        //Draw vertical line for each bin</div><div class="line">        for(int h=0; h&lt;histSize; h++)&#123;</div><div class="line">            float binVal = hist.at&lt;float&gt;(h);</div><div class="line">            if(binVal&gt;0)&#123;</div><div class="line">                int intensity = static_cast&lt;int&gt;(binVal*hpt/maxVal);</div><div class="line">                cv::line(histImg, cv::Point(h*zoom, histSize*zoom), cv::Point(h*zoom, (histSize - intensity)*zoom),cv::Scalar(0),zoom);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        return histImg;</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">&#125;;</div><div class="line"></div><div class="line">#endif //CLIONS_GRAYHISTOGRAM_H</div><div class="line"></div></pre></td></tr></table></figure>
<h6 id="main-cpp"><a href="#main-cpp" class="headerlink" title="main.cpp"></a>main.cpp</h6><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/core.hpp&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/highgui.hpp&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/imgproc.hpp&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"imageInfo.h"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"grayhistogram.h"</span></span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">    cv::Mat image = cv::imread(<span class="string">"/home/shensir/Documents/MyPrograming/Cpp/Clions/data/cattle.png"</span>,<span class="number">0</span>); <span class="comment">// gray</span></div><div class="line">    cv::imshow(<span class="string">"Original Image"</span>, image);</div><div class="line">    <span class="comment">// The histogram object</span></div><div class="line">    Histogram1D h;</div><div class="line"></div><div class="line">    <span class="comment">//Compute the histogram</span></div><div class="line">    cv::Mat histo = h.getHistogram(image);</div><div class="line"></div><div class="line">    <span class="comment">// Loop over each bin</span></div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">256</span>; i++)&#123;</div><div class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span>&lt;&lt;<span class="string">"Value "</span>&lt;&lt;i&lt;&lt;<span class="string">" = "</span></div><div class="line">                              &lt;&lt;histo.at&lt;<span class="keyword">float</span>&gt;(i)&lt;&lt;<span class="built_in">std</span>::<span class="built_in">endl</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    cv::imshow(<span class="string">"Histogram"</span>, h.getHistogramImage(image));</div><div class="line"></div><div class="line">    cv::waitKey(<span class="number">0</span>);</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div></pre></td></tr></table></figure>
<p>输出：</p>
<blockquote>
<p>Value 0 = 73<br>Value 1 = 94<br>Value 2 = 288<br>Value 3 = 157<br>…</p>
</blockquote>
<p><img src="http://blog-1252464519.costj.myqcloud.com/170502/hist1.png" alt=""></p>
<h5 id="多通道-彩色"><a href="#多通道-彩色" class="headerlink" title="多通道[彩色]"></a>多通道[彩色]</h5><h6 id="main-cpp-1"><a href="#main-cpp-1" class="headerlink" title="main.cpp"></a>main.cpp</h6><p>这里，为了更好地展示图片，我们仿照上面的方法，对文档代码进行了修改。主要就是动态限制了直方图高度。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">#include "opencv2/highgui.hpp"</div><div class="line">#include "opencv2/imgcodecs.hpp"</div><div class="line">#include "opencv2/imgproc.hpp"</div><div class="line">#include &lt;iostream&gt;</div><div class="line"></div><div class="line">using namespace std;</div><div class="line">using namespace cv;</div><div class="line"></div><div class="line"></div><div class="line">int main()&#123;</div><div class="line">    Mat src, dst;</div><div class="line">    src = imread("/home/shensir/Documents/MyPrograming/Cpp/Clions/data/cattle.png", IMREAD_COLOR);</div><div class="line"></div><div class="line">    if(src.empty()) return  -1;</div><div class="line">    else imshow("Original Image", src);</div><div class="line"></div><div class="line">    vector&lt;Mat&gt;bgr_planes;</div><div class="line">    split(src, bgr_planes);</div><div class="line"></div><div class="line">    int histSize[1];</div><div class="line">    histSize[0] = 256;</div><div class="line"></div><div class="line">    float range[] = &#123;0, 256&#125;;</div><div class="line">    const float* histRange[2] = &#123;range&#125;;</div><div class="line"></div><div class="line">    bool uniform = true;</div><div class="line">    bool accumulate = false;</div><div class="line"></div><div class="line">    Mat b_hist, g_hist, r_hist;</div><div class="line"></div><div class="line">    calcHist(&amp;bgr_planes[0], 1, 0, Mat(), b_hist, 1, histSize, histRange, uniform, accumulate);</div><div class="line">    calcHist(&amp;bgr_planes[1], 1, 0, Mat(), g_hist, 1, histSize, histRange, uniform, accumulate);</div><div class="line">    calcHist(&amp;bgr_planes[2], 1, 0, Mat(), r_hist, 1, histSize, histRange, uniform, accumulate);</div><div class="line"></div><div class="line">    // Draw the histograms for B, G, and R</div><div class="line">    double maxVal = 0;</div><div class="line">    double minVal = 0;</div><div class="line">    cv::minMaxLoc(b_hist, &amp;minVal, &amp;maxVal, 0, 0);</div><div class="line">    cv::minMaxLoc(g_hist, &amp;minVal, &amp;maxVal, 0, 0);</div><div class="line">    cv::minMaxLoc(r_hist, &amp;minVal, &amp;maxVal, 0, 0);</div><div class="line"></div><div class="line">    int hpt = static_cast&lt;int&gt;(0.9*histSize[0]);</div><div class="line"></div><div class="line">    int hist_w = 512; int hist_h = 400;</div><div class="line">    int bin_w = cvRound((double)hist_w / histSize[0]);</div><div class="line">    Mat histImage(hist_h, hist_w, CV_8UC3, Scalar(0,0,0));</div><div class="line"></div><div class="line">    // normalization</div><div class="line">    normalize(b_hist, b_hist, 0, histImage.rows, NORM_MINMAX, -1, Mat());</div><div class="line">    normalize(b_hist, b_hist, 0, histImage.rows, NORM_MINMAX, -1, Mat());</div><div class="line">    normalize(b_hist, b_hist, 0, histImage.rows, NORM_MINMAX, -1, Mat());</div><div class="line"></div><div class="line">    for(int i=1; i&lt;histSize[0]; i++)</div><div class="line">    &#123;</div><div class="line">        line(histImage, Point(bin_w*(i-1), hist_h - cvRound(b_hist.at&lt;float&gt;(i-1)*hpt/maxVal)),</div><div class="line">                        Point(bin_w*i, hist_h - cvRound(b_hist.at&lt;float&gt;(i)*hpt/maxVal)),</div><div class="line">                        Scalar(255, 0, 0), 2, 8, 0);</div><div class="line"></div><div class="line">        line(histImage, Point(bin_w*(i-1), hist_h - cvRound(g_hist.at&lt;float&gt;(i-1)*hpt/maxVal)),</div><div class="line">             Point(bin_w*i, hist_h - cvRound(g_hist.at&lt;float&gt;(i)*hpt/maxVal)),</div><div class="line">             Scalar(0, 255, 0), 2, 8, 0);</div><div class="line"></div><div class="line">        line(histImage, Point(bin_w*(i-1), hist_h - cvRound(r_hist.at&lt;float&gt;(i-1)*hpt/maxVal)),</div><div class="line">             Point(bin_w*i, hist_h - cvRound(r_hist.at&lt;float&gt;(i)*hpt/maxVal)),</div><div class="line">             Scalar(0, 0, 255), 2, 8, 0);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    imshow("calcHist", histImage);</div><div class="line">    waitKey(0);</div><div class="line"></div><div class="line">    return 0;</div><div class="line">&#125;</div><div class="line"></div></pre></td></tr></table></figure>
<p>输出：</p>
<p><img src="http://blog-1252464519.costj.myqcloud.com/170502/hist2.png" alt=""></p>
<h5 id="直方图的修正"><a href="#直方图的修正" class="headerlink" title="直方图的修正"></a>直方图的修正</h5><p>先来看下什么是图像增强技术：</p>
<blockquote>
<p>图像增强技术是一大类基本的图像处理技术，目的是对一幅图像进行 加工，突出图像中的某些信息，削弱或除去某些不需要的信息，以得 到对具体应用来说视觉效果更好、更有用的图像，或转换成一种更适<br>合人或机器进行分析处理的形式。</p>
</blockquote>
<p>而图像增强方法分为空间域法和频率域法，空间域法是指在空间域内直接对像素的灰度值进行运算处理，我们这里将要介绍的直方图的修正，还有在下一篇笔记<a href="http://datahonor.com/2017/05/04/Look-up-tables/">look-ip table</a><br>里面用到了灰度变换都属于常用的空间域法。与之对应的频率域法是一种间接的处理方法。它是在图像的某种变换宇内，对图像的变换值进行增强处理，然后通过逆变换获得增强图像。</p>
<h6 id="直方图的均衡化-histogram-equalization"><a href="#直方图的均衡化-histogram-equalization" class="headerlink" title="直方图的均衡化(histogram equalization)"></a>直方图的均衡化(histogram equalization)</h6><p>均衡化的原理是使得变换后的图像灰度的概率密度均匀分布，即变换后的图像是衣服灰度级均匀分布的图像，这意味着图像灰度的动态范围得到了增加，从而可提高图像的对比度。<br>转换过程类似这种形式：<br><img src="/2017/05/02/Computing-an-image-histogram/" alt=""></p>
<p>简单讲就是转换为其累计密度分布的形式。具体的推导过程见参考资料。</p>
<p>在OpenCV中已经有了相应的函数，我们来看下它的效果：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"opencv2/highgui.hpp"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"opencv2/imgproc.hpp"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"grayhistogram.h"</span></span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    cv::Mat image;</div><div class="line">    Histogram1D h;</div><div class="line"></div><div class="line">    image = cv::imread(<span class="string">"/home/shensir/Documents/MyPrograming/Cpp/Clions/data/dark.jpeg"</span>, <span class="number">0</span>);</div><div class="line">    cv::imshow(<span class="string">"Original Image"</span>, image);</div><div class="line">    cv::imshow(<span class="string">"Original Hist"</span>, h.getHistogramImage(image));</div><div class="line"></div><div class="line">    cv::Mat equed;</div><div class="line">    cv::equalizeHist(image, equed);</div><div class="line">    cv::imshow(<span class="string">"Equed"</span>, equed);</div><div class="line">    cv::imshow(<span class="string">"Equed Hist"</span>, h.getHistogramImage(equed));</div><div class="line"></div><div class="line">    cv::waitKey(<span class="number">0</span>);</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div></pre></td></tr></table></figure>
<p>输出：<br><img src="http://blog-1252464519.costj.myqcloud.com/170505/Selection_050511%3A02%3A11.png" alt=""></p>
<h6 id="直方图的规定化-histogram-specification-matching"><a href="#直方图的规定化-histogram-specification-matching" class="headerlink" title="直方图的规定化(histogram specification/matching)"></a>直方图的规定化(histogram specification/matching)</h6><p>定义：</p>
<blockquote>
<p>是指将一幅图像通过灰度变换后，使其具有特定的直方图形式，如使图像与某一标准图像具有相同的直方图，或使图像具有某一特定函数形式的直方图。</p>
</blockquote>
<p>可以看到规定化是将原来的直方图转化为指定的形式。先将两个图像都进行均衡化处理，之后让被转化的直方图向目标直方图靠拢来得到目的。</p>
<p>在OpenCV中没有特定函数实现规定化，我从Scribd找来实现的代码，参考一下：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"opencv2/highgui.hpp"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"opencv2/imgproc.hpp"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"grayhistogram.h"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"></div><div class="line">cv::<span class="function">Mat <span class="title">grayImgSpecification</span><span class="params">(cv::Mat &amp;img1, cv::Mat &amp;img2)</span></span>&#123;</div><div class="line">    cv::Mat img_new = img1.clone();</div><div class="line">    <span class="keyword">int</span> grayLevel = <span class="number">256</span>;</div><div class="line"></div><div class="line">    <span class="comment">// Histogram</span></div><div class="line">    Histogram1D h;</div><div class="line">    cv::Mat histogram1 = h.getHistogram(img1);</div><div class="line">    cv::Mat histogram2 = h.getHistogram(img2);</div><div class="line"><span class="comment">//    cv::imshow("img1-original histogram", h.getHistogramImage(img1));</span></div><div class="line"><span class="comment">//    cv::imshow("img2-original histogram", h.getHistogramImage(img2));</span></div><div class="line"></div><div class="line">    <span class="comment">// Specifuication</span></div><div class="line">    <span class="keyword">float</span> * prImg1 = <span class="keyword">new</span> <span class="keyword">float</span>[grayLevel];</div><div class="line">    <span class="keyword">float</span> * mapImg1 = <span class="keyword">new</span> <span class="keyword">float</span>[grayLevel];</div><div class="line">    <span class="keyword">float</span> * prImg2 = <span class="keyword">new</span> <span class="keyword">float</span>[grayLevel];</div><div class="line"></div><div class="line">    <span class="keyword">float</span> n1 = img1.rows * img1.cols;</div><div class="line">    <span class="keyword">float</span> n2 = img2.rows * img2.cols;</div><div class="line"></div><div class="line">    <span class="comment">// 不同灰度级所占的比例</span></div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;grayLevel; i++ )&#123;</div><div class="line">        <span class="keyword">float</span> nk = histogram1.at&lt;<span class="keyword">float</span>&gt;(i);</div><div class="line">        prImg1[i] = nk/n1;</div><div class="line"></div><div class="line">        nk = histogram2.at&lt;<span class="keyword">float</span>&gt;(i);</div><div class="line">        prImg2[i] = nk/n2;</div><div class="line"></div><div class="line">        mapImg1[i] = <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// 累加</span></div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;grayLevel; i++)&#123;</div><div class="line">        prImg1[i] = prImg1[i<span class="number">-1</span>] + prImg1[i];</div><div class="line">        prImg2[i] = prImg2[i<span class="number">-1</span>] + prImg2[i];</div><div class="line"></div><div class="line">    &#125;</div><div class="line">    prImg1[grayLevel - <span class="number">1</span>] = prImg2[grayLevel - <span class="number">1</span>] = <span class="number">1</span>;</div><div class="line"></div><div class="line">    <span class="comment">// Mapping</span></div><div class="line">    <span class="keyword">int</span> currentID = <span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;grayLevel; i++)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">bool</span> mapped = <span class="literal">false</span>;</div><div class="line">        <span class="keyword">while</span>(mapped== <span class="literal">false</span>)&#123;</div><div class="line">            <span class="keyword">if</span>(prImg1[i] &lt;= prImg2[currentID])</div><div class="line">            &#123;</div><div class="line">                mapImg1[i] = currentID;</div><div class="line">                mapped = <span class="literal">true</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">else</span></div><div class="line">            &#123;</div><div class="line">                currentID++;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// new Image</span></div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;img_new.rows; i++)&#123;</div><div class="line">        uchar* data = img_new.ptr&lt;uchar&gt;(i);</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;img_new.cols;j++)&#123;</div><div class="line">            <span class="keyword">int</span> grayVale = (<span class="keyword">int</span>)data[j*img_new.channels()+<span class="number">0</span>];</div><div class="line">            <span class="keyword">float</span> val = mapImg1[grayVale];</div><div class="line">            data[j*img_new.channels()+<span class="number">0</span>] = val;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> img_new;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="comment">// Read image</span></div><div class="line">    cv::Mat img1 = cv::imread(<span class="string">"/home/shensir/Documents/MyPrograming/Cpp/Clions/data/desert.jpg"</span>);</div><div class="line">    cv::Mat img2 = cv::imread(<span class="string">"/home/shensir/Documents/MyPrograming/Cpp/Clions/data/sea.jpg"</span>);</div><div class="line"></div><div class="line">    <span class="comment">// split</span></div><div class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::Mat&gt;img1_bgrplanes;</div><div class="line">    cv::split(img1, img1_bgrplanes);</div><div class="line"></div><div class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::Mat&gt;img2_bgrplanes;</div><div class="line">    cv::split(img2, img2_bgrplanes);</div><div class="line"></div><div class="line">    cv::Mat img_new0 = grayImgSpecification(img1_bgrplanes[<span class="number">0</span>], img2_bgrplanes[<span class="number">0</span>]);</div><div class="line">    cv::Mat img_new1 = grayImgSpecification(img1_bgrplanes[<span class="number">1</span>], img2_bgrplanes[<span class="number">1</span>]);</div><div class="line">    cv::Mat img_new2 = grayImgSpecification(img1_bgrplanes[<span class="number">2</span>], img2_bgrplanes[<span class="number">2</span>]);</div><div class="line"></div><div class="line">    cv::Mat img_news;</div><div class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::Mat&gt;img_new_planes;</div><div class="line">    img_new_planes= &#123;img_new0, img_new1, img_new2&#125;;</div><div class="line">    cv::merge(img_new_planes, img_news);</div><div class="line">    cv::imshow(<span class="string">"Img_news"</span>, img_news);</div><div class="line">    cv::imwrite(<span class="string">"specification.jpg"</span>, img_news);</div><div class="line"></div><div class="line">    cv::waitKey(<span class="number">0</span>);</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"></div></pre></td></tr></table></figure>
<p>输出：</p>
<p><img src="http://blog-1252464519.costj.myqcloud.com/170505/Selection_050512%3A26%3A29.png" alt=""></p>
<p>根据上面已经提到的，我们来获取原来的图片和新生成图片的彩色直方图：</p>
<p><img src="http://blog-1252464519.costj.myqcloud.com/170505/Selection_050501.png" alt=""></p>
<p><img src="http://blog-1252464519.costj.myqcloud.com/170505/Selection_050502.png" alt=""></p>
<p><img src="http://blog-1252464519.costj.myqcloud.com/170505/Selection_050503.png" alt=""></p>
<p>可以看到，最后生成的直方图和目标直方图(sea-hist)是基本一致的，这样就是达到了正规化的目的。</p>
<h4 id="直方图比较"><a href="#直方图比较" class="headerlink" title="直方图比较"></a>直方图比较</h4><p>我们也可以通过比较直方图来检测图像的相似度</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"opencv2/highgui.hpp"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"opencv2/imgproc.hpp"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"grayhistogram.h"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"colorhistogram.h"</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">class</span> ImageCompparator&#123;</div><div class="line"><span class="keyword">private</span>:</div><div class="line">    cv::Mat refH;  <span class="comment">// reference histogram</span></div><div class="line">    cv::Mat inputH;  <span class="comment">// histogram of input image</span></div><div class="line"></div><div class="line">    ColorHistogram hist;  <span class="comment">// to generate the histograms number of bins used in each color channel</span></div><div class="line">    <span class="keyword">int</span> nBins;</div><div class="line"></div><div class="line"><span class="keyword">public</span>:</div><div class="line">    ImageCompparator():nBins(<span class="number">8</span>)&#123;&#125;</div><div class="line"></div><div class="line">    <span class="comment">// set and compute histogram of reference image</span></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setReferenceImage</span><span class="params">(<span class="keyword">const</span> cv::Mat &amp;image)</span></span>&#123;</div><div class="line">        hist.setSize(nBins);</div><div class="line">        refH = hist.getHistogram(image);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// comapre the image using their BGR histograms</span></div><div class="line">    <span class="function"><span class="keyword">double</span> <span class="title">compare</span><span class="params">(<span class="keyword">const</span> cv::Mat &amp;image)</span></span>&#123;</div><div class="line">        inputH = hist.getHistogram(image);</div><div class="line"></div><div class="line">        <span class="comment">//histogram comparison using intersection</span></div><div class="line">        <span class="keyword">return</span> cv::compareHist(refH, inputH, cv::HISTCMP_INTERSECT);</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">    cv::Mat image;</div><div class="line">    image = cv::imread(<span class="string">"/home/shensir/Documents/MyPrograming/Cpp/Clions/data/waves.jpg"</span>);</div><div class="line">    cv::imshow(<span class="string">"Original Image"</span>, image);</div><div class="line"></div><div class="line">    ImageCompparator c;</div><div class="line">    c.setReferenceImage(image);</div><div class="line"></div><div class="line">    cv::Mat wave, beach, cattle;</div><div class="line">    wave = cv::imread(<span class="string">"/home/shensir/Documents/MyPrograming/Cpp/Clions/data/waves.jpg"</span>);  <span class="comment">// 和自身比较</span></div><div class="line">    beach = cv::imread(<span class="string">"/home/shensir/Documents/MyPrograming/Cpp/Clions/data/beach.jpg"</span>);  <span class="comment">// 和较为相似的比较</span></div><div class="line">    cattle = cv::imread(<span class="string">"/home/shensir/Documents/MyPrograming/Cpp/Clions/data/cattle.png"</span>);  <span class="comment">// 和不相似的比较</span></div><div class="line"></div><div class="line"></div><div class="line">    <span class="keyword">double</span> waves = c.compare(wave);</div><div class="line">    cv::imshow(<span class="string">"wave's score: "</span>+<span class="built_in">std</span>::to_string(waves), wave);</div><div class="line">    <span class="keyword">double</span> beachs = c.compare(beach);</div><div class="line">    cv::imshow(<span class="string">"beach's score: "</span>+<span class="built_in">std</span>::to_string(beachs), beach);</div><div class="line">    <span class="keyword">double</span> cattles = c.compare(cattle);</div><div class="line">    cv::imshow(<span class="string">"cattle's score: "</span>+<span class="built_in">std</span>::to_string(cattles), cattle);</div><div class="line"></div><div class="line">    cv::waitKey(<span class="number">0</span>);</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"></div></pre></td></tr></table></figure>
<p><img src="http://blog-1252464519.costj.myqcloud.com/170505/cmphists.png" alt=""></p>
<h4 id="Refrence"><a href="#Refrence" class="headerlink" title="Refrence"></a>Refrence</h4><p><a href="https://www.scribd.com/document/106790597/OPENCV-Topic-04-Histogram-Specification" target="_blank" rel="external">Scribd代码</a></p>
<p><a href="http://bj3s.pku.edu.cn/activity/subjects/lesson6.pdf" target="_blank" rel="external">北大遥感课件</a></p>
<p>山东科大《数字图像处理》</p>

      
    </div>

    <div>
      
        
<div class="my_post_copyright">
  <script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>
  
  <!-- JS库 sweetalert 可修改路径 -->
  <script type="text/javascript" src="http://jslibs.wuxubj.cn/sweetalert_mini/jquery-1.7.1.min.js"></script>
  <script src="http://jslibs.wuxubj.cn/sweetalert_mini/sweetalert.min.js"></script>
  <link rel="stylesheet" type="text/css" href="http://jslibs.wuxubj.cn/sweetalert_mini/sweetalert.mini.css">
  <p><span>本文标题:</span><a href="/2017/05/02/Computing-an-image-histogram/">OpenCV系列笔记十三：Computing an image histogram</a></p>
  <p><span>文章作者:</span><a href="/" title="访问 不秩稚童 的个人博客">不秩稚童</a></p>
  <p><span>发布时间:</span>2017年05月02日 - 16:05</p>
  <p><span>最后更新:</span>2017年05月07日 - 00:05</p>
  <p><span>原始链接:</span><a href="/2017/05/02/Computing-an-image-histogram/" title="OpenCV系列笔记十三：Computing an image histogram">http://datahonor.com/2017/05/02/Computing-an-image-histogram/</a>
    <span class="copy-path"  title="点击复制文章链接"><i class="fa fa-clipboard" data-clipboard-text="http://datahonor.com/2017/05/02/Computing-an-image-histogram/"  aria-label="复制成功！"></i></span>
  </p>
  <p><span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">署名-非商业性使用-禁止演绎 4.0 国际</a> 转载请保留原文链接及作者。</p>  
</div>
<script> 
    var clipboard = new Clipboard('.fa-clipboard');
	clipboard.on('success', $(function(){
	  $(".fa-clipboard").click(function(){
		swal({   
		  title: "",   
		  text: '复制成功',   
		  html: false,
		  timer: 500,   
		  showConfirmButton: false
	    });
	  });
    }));  
</script>


      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>


    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Cpp/" rel="tag"># Cpp</a>
          
            <a href="/tags/OpenCV/" rel="tag"># OpenCV</a>
          
        </div>
      

      
        
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/05/02/Using-colors-for-detection-skin-tone-detection/" rel="next" title="OpenCV系列笔记十二：Using colors for detection - skin tone detection">
                <i class="fa fa-chevron-left"></i> OpenCV系列笔记十二：Using colors for detection - skin tone detection
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/05/04/Look-up-tables/" rel="prev" title="OpenCV系列笔记十四：Look-up tables">
                OpenCV系列笔记十四：Look-up tables <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
        
<script>
  with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='//bdimg.share.baidu.com/static/api/js/share.js?cdnversion='+~(-new Date()/36e5)];
</script>

      
    </div>
  </div>

          
          </div>
          


          
  <div class="comments" id="comments">

    
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    
  </div>









        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="https://avatars2.githubusercontent.com/u/17157965?v=3&u=1787d5d04d50967c7825062bfff705ee584ae2b2&s=400"
               alt="不秩稚童" />
          <p class="site-author-name" itemprop="name">不秩稚童</p>
           
              <p class="site-description motion-element" itemprop="description">十年饮冰，难凉热血。</p>
          
        </div>
        <nav class="site-state motion-element">
        
          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">67</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">8</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">25</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/shenxiangzhuang" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.zhihu.com/people/shen-xiang-zhuang" target="_blank" title="知乎">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  知乎
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.cnblogs.com/buzhizhitong" target="_blank" title="博客园">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  博客园
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-4"><a class="nav-link" href="#Overview"><span class="nav-text">Overview</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Code"><span class="nav-text">Code</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#单通道-灰度图"><span class="nav-text">单通道[灰度图]</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#grayhistogram-h"><span class="nav-text">grayhistogram.h</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#main-cpp"><span class="nav-text">main.cpp</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#多通道-彩色"><span class="nav-text">多通道[彩色]</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#main-cpp-1"><span class="nav-text">main.cpp</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#直方图的修正"><span class="nav-text">直方图的修正</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#直方图的均衡化-histogram-equalization"><span class="nav-text">直方图的均衡化(histogram equalization)</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#直方图的规定化-histogram-specification-matching"><span class="nav-text">直方图的规定化(histogram specification/matching)</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#直方图比较"><span class="nav-text">直方图比较</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Refrence"><span class="nav-text">Refrence</span></a></li></ol></div>
            


          </div>
        </section>
      <!--/noindex-->
      

      


    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">不秩稚童</span>
</div>



        

<div class="busuanzi-count">

  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv"><i class="fa fa-user"></i>本站访客数<span class="busuanzi-value" id="busuanzi_value_site_uv"></span>人次</span>
  

  
    <span class="site-pv"><i class="fa fa-eye"></i>本站总访问量<span class="busuanzi-value" id="busuanzi_value_site_pv"></span>次</span>
  
  
</div>



        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    
    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  

    <script type="text/javascript">
      var disqus_shortname = 'http-datahonor-com';
      var disqus_identifier = '2017/05/02/Computing-an-image-histogram/';

      var disqus_title = "OpenCV系列笔记十三：Computing an image histogram";


      function run_disqus_script(disqus_script) {
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      }

      run_disqus_script('count.js');

      
        var disqus_config = function () {
            this.page.url = disqus_url;
            this.page.identifier = disqus_identifier;
            this.page.title = disqus_title;
        };
        run_disqus_script('embed.js');
      

    </script>
  










  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
      search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();
    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';
      $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = $( "entry", xmlResponse ).map(function() {
            return {
              title: $( "title", this ).text(),
              content: $("content",this).text(),
              url: $( "url" , this).text()
            };
          }).get();
          var $input = document.getElementById(search_id);
          var $resultContent = document.getElementById(content_id);
          $input.addEventListener('input', function(){
            var matchcounts = 0;
            var str='<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length > 1) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var content_index = [];
                var data_title = data.title.trim().toLowerCase();
                var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                var data_url = decodeURIComponent(data.url);
                var index_title = -1;
                var index_content = -1;
                var first_occur = -1;
                // only match artiles with not empty titles and contents
                if(data_title != '') {
                  keywords.forEach(function(keyword, i) {
                    index_title = data_title.indexOf(keyword);
                    index_content = data_content.indexOf(keyword);
                    if( index_title >= 0 || index_content >= 0 ){
                      isMatch = true;
                      if (i == 0) {
                        first_occur = index_content;
                      }
                    }

                  });
                }
                // show search results
                if (isMatch) {
                  matchcounts += 1;
                  str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                  var content = data.content.trim().replace(/<[^>]+>/g,"");
                  if (first_occur >= 0) {
                    // cut out 100 characters
                    var start = first_occur - 20;
                    var end = first_occur + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if(start == 0){
                      end = 50;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    var match_content = content.substring(start, end);
                    // highlight all keywords
                    keywords.forEach(function(keyword){
                      var regS = new RegExp(keyword, "gi");
                      match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                    });

                    str += "<p class=\"search-result\">" + match_content +"...</p>"
                  }
                  str += "</li>";
                }
              })};
            str += "</ul>";
            if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
            if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
            $resultContent.innerHTML = str;
          });
          proceedsearch();
        }
      });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>


  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  


  
  <!-- 页面点击小红心 -->
  <script type="text/javascript" src="/js/src/love.js"></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->

</body>
</html>
